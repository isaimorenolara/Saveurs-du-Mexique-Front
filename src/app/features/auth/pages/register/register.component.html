<section class="container section">
    <div class="white-card register">
        <header class="pp-head animate__animated animate__fadeInDown">
            <h2 class="pp-title sub-brand m-0"><strong>Sign up</strong></h2>
            <p class="text-muted">Create your account in three simple steps.</p>
        </header>

        <ol class="stepper">
            <li [class.active]="step===0">Account</li>
            <li [class.active]="step===1">Profile</li>
            <li [class.active]="step===2">Address</li>
        </ol>

        <section class="white-subcard" *ngIf="step===0">
            <form class="row g-3 needs-validation" novalidate>
                <div class="col-12">
                    <label class="form-label" for="email">Email</label>
                    <input id="email" name="email" class="form-control" type="email" required email autocomplete="email"
                        inputmode="email" pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[A-Za-z]{2,}$"
                        [(ngModel)]="register.account.email" #emailCtrl="ngModel"
                        [class.is-valid]="emailCtrl.valid && (emailCtrl.dirty || emailCtrl.touched)"
                        [class.is-invalid]="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">Enter a valid email (e.g. name&#64;domain.com).</div>
                </div>

                <div class="col-md-6">
                    <label class="form-label" for="password">Password</label>
                    <div class="input-group has-validation">
                        <input id="password" name="password" class="form-control" [type]="showPwd ? 'text' : 'password'"
                            required autocomplete="new-password" pattern="(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}"
                            [(ngModel)]="register.account.password" #pwdCtrl="ngModel"
                            [class.is-valid]="pwdCtrl.valid && (pwdCtrl.dirty || pwdCtrl.touched)"
                            [class.is-invalid]="pwdCtrl.invalid && (pwdCtrl.dirty || pwdCtrl.touched)"
                            (paste)="$event.preventDefault()" (copy)="$event.preventDefault()"
                            (cut)="$event.preventDefault()" spellcheck="false" placeholder="••••••••" />
                        <button type="button" class="btn btn-outline-secondary" (click)="showPwd = !showPwd"
                            tabindex="-1">
                            <i class="fa-solid" [class.fa-eye]="!showPwd" [class.fa-eye-slash]="showPwd"></i>
                        </button>
                        <div class="invalid-feedback">Min 8 chars, include number &amp; special.</div>
                        <div class="valid-feedback">Strong password.</div>
                    </div>
                </div>

                <div class="col-md-6">
                    <label class="form-label" for="confirm">Confirm password</label>
                    <div class="input-group has-validation">
                        <input id="confirm" name="confirm" class="form-control"
                            [type]="showConfirmPwd ? 'text' : 'password'" required autocomplete="new-password"
                            [(ngModel)]="confirm" #confirmCtrl="ngModel"
                            [class.is-valid]="confirm && register.account.password === confirm && (confirmCtrl.dirty || confirmCtrl.touched)"
                            [class.is-invalid]="confirm && register.account.password !== confirm && (confirmCtrl.dirty || confirmCtrl.touched)"
                            (paste)="$event.preventDefault()" (copy)="$event.preventDefault()"
                            (cut)="$event.preventDefault()" spellcheck="false" placeholder="••••••••" />
                        <button type="button" class="btn btn-outline-secondary"
                            (click)="showConfirmPwd = !showConfirmPwd" tabindex="-1">
                            <i class="fa-solid" [class.fa-eye]="!showConfirmPwd"
                                [class.fa-eye-slash]="showConfirmPwd"></i>
                        </button>
                        <div class="valid-feedback">Passwords match.</div>
                        <div class="invalid-feedback">Passwords do not match.</div>
                    </div>
                </div>

                <div class="col-md-6">
                    <label class="form-label" for="dob">Date of birth</label>
                    <input id="dob" name="dob" class="form-control" type="date" required
                        [(ngModel)]="register.account.dob" #dobCtrl="ngModel"
                        [class.is-valid]="register.account.dob && isAdult(register.account.dob) && (dobCtrl.dirty || dobCtrl.touched)"
                        [class.is-invalid]="register.account.dob && !isAdult(register.account.dob) && (dobCtrl.dirty || dobCtrl.touched)" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">You must be 18+.</div>
                </div>

                <div class="form-actions mt-3 d-flex justify-content-end gap-2">
                    <a routerLink="/auth/login" class="btn btn-ghost">I already have an account</a>
                    <button class="btn btn-primary" type="button" [disabled]="!validAccount" (click)="next()">
                        Continue
                    </button>
                </div>
            </form>
        </section>

        <section class="white-subcard" *ngIf="step===1">
            <form class="row g-3 needs-validation" novalidate>
                <div class="col-md-6">
                    <label class="form-label" for="firstName">First name</label>
                    <input id="firstName" name="firstName" class="form-control" type="text" required minlength="2"
                        [(ngModel)]="register.profile.firstName" #fnCtrl="ngModel"
                        [class.is-valid]="fnCtrl.valid && (fnCtrl.dirty || fnCtrl.touched)"
                        [class.is-invalid]="fnCtrl.invalid && (fnCtrl.dirty || fnCtrl.touched)" placeholder="Jane" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">At least 2 characters.</div>
                </div>

                <div class="col-md-6">
                    <label class="form-label" for="lastName">Last name</label>
                    <input id="lastName" name="lastName" class="form-control" type="text" required minlength="2"
                        [(ngModel)]="register.profile.lastName" #lnCtrl="ngModel"
                        [class.is-valid]="lnCtrl.valid && (lnCtrl.dirty || lnCtrl.touched)"
                        [class.is-invalid]="lnCtrl.invalid && (lnCtrl.dirty || lnCtrl.touched)" placeholder="Doe" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">At least 2 characters.</div>
                </div>

                <div class="form-actions mt-3 d-flex justify-content-end gap-2">
                    <button class="btn btn-secondary" type="button" (click)="back()">Back</button>
                    <button class="btn btn-primary" type="button" [disabled]="!validProfile" (click)="next()">
                        Continue
                    </button>
                </div>
            </form>
        </section>

        <section class="white-subcard" *ngIf="step===2">
            <form class="row g-3 needs-validation" novalidate>
                <div class="col-12">
                    <label class="form-label" for="street">Street</label>
                    <input id="street" name="street" class="form-control" type="text" required minlength="3"
                        [(ngModel)]="register.address.street" #streetCtrl="ngModel"
                        [class.is-valid]="streetCtrl.valid && (streetCtrl.dirty || streetCtrl.touched)"
                        [class.is-invalid]="streetCtrl.invalid && (streetCtrl.dirty || streetCtrl.touched)"
                        placeholder="Av. Juárez" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">Minimum 3 characters.</div>
                </div>

                <div class="col-md-6">
                    <label class="form-label" for="streetNumber">Number</label>
                    <input id="streetNumber" name="streetNumber" class="form-control" type="text" required
                        [(ngModel)]="register.address.streetNumber" #numCtrl="ngModel"
                        [class.is-valid]="numCtrl.valid && (numCtrl.dirty || numCtrl.touched)"
                        [class.is-invalid]="numCtrl.invalid && (numCtrl.dirty || numCtrl.touched)" placeholder="120A" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">This field is required.</div>
                </div>

                <div class="col-md-6">
                    <label class="form-label" for="zip">ZIP code</label>
                    <input id="zip" name="zip" class="form-control" type="text" required pattern="^[0-9]{5}$"
                        [(ngModel)]="register.address.zip" #zipCtrl="ngModel"
                        [class.is-valid]="zipCtrl.valid && (zipCtrl.dirty || zipCtrl.touched)"
                        [class.is-invalid]="zipCtrl.invalid && (zipCtrl.dirty || zipCtrl.touched)"
                        placeholder="01234" />
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">5 digits.</div>
                </div>

                <div class="form-actions mt-3 d-flex justify-content-end gap-2">
                    <button class="btn btn-secondary" type="button" (click)="back()">Back</button>
                    <button class="btn btn-primary" type="button" [disabled]="!validAddress || loading"
                        (click)="onSubmit()">
                        {{ loading ? 'Creating…' : 'Create account' }}
                    </button>
                </div>

                <p class="text-danger mt-2" *ngIf="mensaje">{{ mensaje }}</p>
            </form>
        </section>
    </div>
</section>